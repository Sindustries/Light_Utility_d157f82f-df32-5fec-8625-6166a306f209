//-----------------------------------
//-LIGHT UTILITY
//-By Sinbane (Dehuman on Nexus)
//-Alters the Light, Daylight, Dancing Lights and Produce Flame spells with some quality of life features such as reapplying the effects, auto-dimming in sunlight, toggling them off/on and a full rework of Dancing Lights to make it behave more like Candlelight from Skyrim.
//-----------------------------------
//-LIGHT

new entry "LIGHT"
type "StatusData"
data "StatusType" "BOOST"
using "LIGHT"
//data "StackId" ""
data "IsUnique" ""
data "StatusPropertyFlags" "DisableCombatlog"

new entry "Target_Light"
type "SpellData"
data "SpellType" "Target"
using "Target_Light"
data "SpellFlags" "HasVerbalComponent;HasSomaticComponent;IsSpell;HasHighGroundRangeExtension"
data "TargetRadius" "18"
data "TargetConditions" "Ally() or Item()"
data "SpellSuccess" "AI_IGNORE:IF(Item() and HasStatus('LIGHT')):RemoveStatus(LIGHT);AI_IGNORE:IF(Item() and not HasStatus('LIGHT')):ApplyStatus(LIGHT,100,100);IF(not Item() and HasStatus('SIN_LIGHT')):ApplyStatus(SIN_LIGHT,100,0);IF(not Item() and not HasStatus('SIN_LIGHT')):ApplyStatus(SIN_LIGHT,100,-1);AI_ONLY:CAST:ApplyStatus(SELF,AI_STATUS_FAKE,100,10)"

new entry "SIN_LIGHT"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "heb56137dgf969g4015g83d9gc5d317214572;1"
data "Description" "h5c501017g9763g4cf9g8159g808b9f0ce60e;1"
data "Icon" "Spell_Evocation_Light"
data "IsUnique" "1"
data "StackId" "SIN_LIGHT"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog"
data "OnApplyFunctors" "ApplyStatus(SIN_Light_Technical,100,-1)"
data "OnRemoveFunctors" "ApplyStatus(SIN_Remove_Light,100,0)"
data "RemoveEvents" "OnSourceDeath"
data "Passives" "SIN_Light_Passive"

new entry "SIN_Light_Passive"
type "PassiveData"
data "Properties" "Temporary;IsHidden"
//HAD SOME ISSUES WITH REAPPLY SPAMMING IN CLOUDS (LIKE DARKNESS, FOG ETC) - ADDED SOME CHECKS
data "Conditions" "Self() and not HasObscuredState(ObscuredState.Clear) and not HasStatus('SNEAKING',context.Source) and not HasStatus('SG_Invisible',context.Source) and not HasStatus('AURA_OF_VILEOBLIVION_BUFF') and not HasStatus('SCL_MOONSHIELD') and not InSurface('SurfaceDarknessCloud') and not InSurface('SurfaceFogCloud') and not InSurface('SurfaceLava') and not InSurface('SurfaceSporeBlackCloud') and not InSurface('SurfaceStinkingCloud') and not InSurface('SurfaceCloudkillCloud')"
data "StatsFunctorContext" "OnEquip;OnUnequip;OnMovedDistance;OnStatusApplied;OnStatusRemoved"
data "StatsFunctors" "ApplyStatus(SELF,SIN_Light_Technical,100,-1)"
data "Boosts" "UnlockSpell(SIN_Light_Dismiss)"

new entry "SIN_Light_Dismiss"
type "SpellData"
data "SpellType" "Shout"
data "SpellProperties" "RemoveStatus(SELF,SIN_LIGHT)"
data "TargetConditions" "Self()"
data "Icon" "Spell_Evocation_Light"
data "DisplayName" "hcc871e17g989ag441fgbb86gcea911d6f825;1"
data "Description" "haf9664dag5daag445fgb11fg9f9940ae2e4d;1"
data "PrepareSound" "Generic_GeneralAction_Start"
data "PrepareLoopSound" "Generic_Summoned_Loop"
data "CastTextEvent" "Cast"
data "UseCosts" "BonusActionPoint:1"
data "SpellAnimation" "dd86aa43-8189-4d9f-9a5c-454b5fe4a197,,;,,;bcc3b0d9-f04f-4448-aab0-e0ad641167cc,,;bf924cc6-8b39-4c3b-b1c0-eda264cf6150,,;cc5b0caf-3ed1-4711-a50d-11dc3f1fdc6a,,;,,;1715b877-4512-472e-9bd0-fd568a112e90,,;,,;,,"
data "VerbalIntent" "Utility"
data "SpellFlags" "Temporary"
data "PrepareEffect" "9e7ec23c-4b13-4a88-b3d6-1df1782e4359"
data "CastEffect" "c33c578f-fc5c-4a9d-a961-78b7bfff73d7"
data "HitEffect" "ebcd0860-3695-4762-b9f5-4e441c4bf888"

new entry "SIN_Light_Technical"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "IsUnique" "1"
data "OnApplyFunctors" "ApplyStatus(SIN_Apply_Light,100,0)"
data "RemoveConditions" "IsInSunlight(context.Source) or HasStatus('AURA_OF_VILEOBLIVION_BUFF',context.Source) or HasStatus('SCL_MOONSHIELD',context.Source) or HasStatus('SNEAKING',context.Source) or HasStatus('SG_Invisible',context.Source) or not HasStatus('SIN_LIGHT',context.Source)"
data "RemoveEvents" "OnObscurityChanged;OnStatusApplied;OnStatusRemoved"
data "OnRemoveFunctors" "IF(RemoveCause(StatusRemoveCause.Condition)):ApplyStatus(SIN_Remove_Light,100,0)"

new entry "SIN_Apply_Light"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "OnApplyFunctors" "IF(not HasStatus('LIGHT',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)) and IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand))):ApplyEquipmentStatus(MeleeMainHand,LIGHT,100,-1);IF(not HasStatus('LIGHT',GetItemInEquipmentSlot(EquipmentSlot.MeleeOffHand)) and IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeOffHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeOffHand))):ApplyEquipmentStatus(MeleeOffHand,LIGHT,100,-1);IF(not HasStatus('LIGHT',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) and IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand))):ApplyEquipmentStatus(RangedMainHand,LIGHT,100,-1);IF(not HasStatus('LIGHT',GetItemInEquipmentSlot(EquipmentSlot.RangedOffHand)) and IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedOffHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedOffHand))):ApplyEquipmentStatus(RangedOffHand,LIGHT,100,-1);IF(not HasStatus('LIGHT',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)) and (Tagged('MUSIC_VFX_LUTE',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)) or Tagged('MUSIC_VFX_VIOLIN',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)) or Tagged('MUSIC_VFX_FLUTE',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)) or Tagged('MUSIC_VFX_LYRE',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)) or Tagged('MUSIC_VFX_DRUM',GetItemInEquipmentSlot(EquipmentSlot.MusicalInstrument)))):ApplyEquipmentStatus(MusicalInstrument,LIGHT,100,-1)"

new entry "SIN_Remove_Light"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "OnApplyFunctors" "ApplyEquipmentStatus(MeleeMainHand,SIN_Remove_Light_Technical,100,0);ApplyEquipmentStatus(MeleeOffHand,SIN_Remove_Light_Technical,100,0);ApplyEquipmentStatus(RangedMainHand,SIN_Remove_Light_Technical,100,0);ApplyEquipmentStatus(RangedOffHand,SIN_Remove_Light_Technical,100,0);ApplyEquipmentStatus(MusicalInstrument,SIN_Remove_Light_Technical,100,0)"

new entry "SIN_Remove_Light_Technical"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "OnApplyFunctors" "RemoveStatus(LIGHT)"

//-----------------------------------
//-DAYLIGHT

new entry "DAYLIGHT"
type "StatusData"
data "StatusType" "BOOST"
using "DAYLIGHT"
data "SoundLoop" ""
data "StatusPropertyFlags" "RemoveOnLongRest;DisableCombatlog"

new entry "Target_Daylight_Enchantment"
type "SpellData"
data "SpellType" "Target"
using "Target_Daylight_Enchantment"
data "TooltipStatusApply" "ApplyStatus(SIN_DAYLIGHT,100,-1)"
data "TooltipPermanentWarnings" "375fe7a4-7a8a-4bbe-812c-0af9584c0740"
data "SpellSuccess" "IF(Item() and not HasStatus('DAYLIGHT')):ApplyStatus(DAYLIGHT,100,20);IF(Item() and not HasStatus('DAYLIGHT_SUNLIGHT_AURA_TECHNICAL')):ApplyStatus(DAYLIGHT_SUNLIGHT_AURA_TECHNICAL,100,20);IF(Item() and HasStatus('DAYLIGHT')):RemoveStatus(DAYLIGHT);IF(Item() and HasStatus('DAYLIGHT_SUNLIGHT_AURA_TECHNICAL')):RemoveStatus(DAYLIGHT_SUNLIGHT_AURA_TECHNICAL);IF(not Item() and HasStatus('SIN_DAYLIGHT')):ApplyStatus(SIN_Remove_Daylight,100,0);IF(not Item() and not HasStatus('SIN_DAYLIGHT')):ApplyStatus(SIN_DAYLIGHT,100,-1)"
data "TargetConditions" "Ally() or Item()"

new entry "SIN_DAYLIGHT"
type "StatusData"
data "StatusType" "BOOST"
data "Icon" "Spell_Evocation_Daylight"
data "DisplayName" "h4d39bd4eg6673g4383g920fg1316c855b332;1"
data "Description" "h501c8532g4976g4e04g8357gdd323a6d11fc;1"
data "IsUnique" "1"
data "StackId" "SIN_LIGHT"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog"
data "OnApplyFunctors" "ApplyStatus(SIN_Daylight_Technical,100,-1)"
data "OnRemoveFunctors" "ApplyStatus(SIN_Remove_Daylight,100,0)"
data "RemoveEvents" "OnSourceDeath"
data "Passives" "SIN_Daylight_Passive"

new entry "SIN_Daylight_Passive"
type "PassiveData"
using "SIN_Light_Passive"
data "StatsFunctors" "ApplyStatus(SELF,SIN_Daylight_Technical,100,-1)"
data "Boosts" "UnlockSpell(SIN_Daylight_Dismiss)"

new entry "SIN_Daylight_Technical"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "IsUnique" "1"
data "OnApplyFunctors" "ApplyStatus(SIN_Apply_Daylight,100,0)"
data "RemoveConditions" "HasStatus('AURA_OF_VILEOBLIVION_BUFF',context.Source) or HasStatus('SNEAKING',context.Source) or HasStatus('SG_Invisible',context.Source) or not HasStatus('SIN_DAYLIGHT',context.Source)"
data "RemoveEvents" "OnStatusApplied;OnStatusRemoved"
data "OnRemoveFunctors" "IF(RemoveCause(StatusRemoveCause.Condition)):ApplyStatus(SIN_Remove_Daylight,100,0)"

new entry "SIN_Daylight_Dismiss"
type "SpellData"
data "SpellType" "Shout"
using "SIN_Light_Dismiss"
data "SpellProperties" "RemoveStatus(SELF,SIN_DAYLIGHT)"
data "Icon" "Spell_Evocation_Daylight"
data "DisplayName" "h5cda27b3gda5fg4f56g89d8gb3c8be5f9bee;1"
data "Description" "h86d23048g5852g4e75g9932g0aa84ce63b8b;1"

new entry "SIN_Apply_Daylight"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "OnApplyFunctors" "IF(not HasStatus('DAYLIGHT',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)) and (IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)))):ApplyEquipmentStatus(MeleeMainHand,DAYLIGHT,100,-1);IF(not HasStatus('DAYLIGHT_SUNLIGHT_AURA_TECHNICAL',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand) and (IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.MeleeMainHand))))):ApplyEquipmentStatus(MeleeMainHand,DAYLIGHT_SUNLIGHT_AURA_TECHNICAL,100,-1);IF(not HasStatus('DAYLIGHT',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) and (IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)))):ApplyEquipmentStatus(RangedMainHand,DAYLIGHT,100,-1);IF(not HasStatus('DAYLIGHT_SUNLIGHT_AURA_TECHNICAL',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) and (IsWeaponOfProficiencyGroup('SimpleWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)) or IsWeaponOfProficiencyGroup('MartialWeapons',GetItemInEquipmentSlot(EquipmentSlot.RangedMainHand)))):ApplyEquipmentStatus(RangedMainHand,DAYLIGHT_SUNLIGHT_AURA_TECHNICAL,100,-1)"

new entry "SIN_Remove_Daylight"
type "StatusData"
data "StatusType" "BOOST"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "OnApplyFunctors" "ApplyEquipmentStatus(MeleeMainHand,DAYLIGHT,100,0);ApplyEquipmentStatus(MeleeMainHand,DAYLIGHT_SUNLIGHT_AURA_TECHNICAL,100,0);ApplyEquipmentStatus(RangedMainHand,DAYLIGHT,100,0);ApplyEquipmentStatus(RangedMainHand,DAYLIGHT_SUNLIGHT_AURA_TECHNICAL,100,0)"

//-----------------------------------
//-CANDLELIGHT

new entry "Target_DancingLights"
type "SpellData"
data "SpellType" "Target"
using "Target_DancingLights"
data "SpellProperties" "AI_IGNORE:IF(Ally() and HasStatus('SIN_CANDLELIGHT')):RemoveStatus(SIN_CANDLELIGHT);AI_IGNORE:IF(Ally() and not HasStatus('SIN_CANDLELIGHT')):ApplyStatus(SIN_CANDLELIGHT,100,-1);AI_ONLY:GROUND:Summon(2064328c-a090-454f-b3b8-b488bbe64567,10,,,,DANCING_LIGHTS)"
//data "TargetConditions" "Ally()"
data "TargetRadius" "18"
data "Icon" "Spell_Evocation_DancingLights"
data "DisplayName" "h2ccf48a1ga645g4912ga860gfedacfac3421;1"
data "Description" "h848c9047g2f81g4c8eg8379gedc8d5d75db8;1"
data "DescriptionParams" "Distance(3)"
data "TooltipStatusApply" "ApplyStatus(SIN_CANDLELIGHT,100,-1)"
data "TooltipPermanentWarnings" "375fe7a4-7a8a-4bbe-812c-0af9584c0740"
data "SpellFlags" "HasVerbalComponent;HasSomaticComponent;IsSpell;HasHighGroundRangeExtension;CannotTargetItems"
data "PrepareEffect" "7121a488-7c9a-4ba1-a585-f79aaa77e97c"
data "CastEffect" "518bc78f-c169-43ba-b951-977d75429199"
data "PositionEffect" "12c0e505-2b3a-4f31-bbb8-c6aa6d4b4977"

new entry "SIN_CANDLELIGHT"
type "StatusData"
data "StatusType" "BOOST"
data "DisplayName" "h649cae7fg3d63g457bgb92dg1f9b08d80b3d;1"
data "Description" "h4cec837egf309g4426g8dc3g5e7ec426a48a;1"
data "DescriptionParams" "Distance(3)"
data "Icon" "statIcons_RadiatingOrb"
data "IsUnique" "1"
data "StackId" "SIN_LIGHT"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog"
data "OnRemoveFunctors" "RemoveStatus(SIN_Candlelight_Orb)"
data "RemoveEvents" "OnSourceDeath"
data "Passives" "SIN_Candlelight_Passive"

new entry "SIN_Candlelight_Passive"
type "PassiveData"
data "DisplayName" "h9e37347dgb0edg4632g917cg6092180c0607;1"
data "Description" "h149d42f7g6414g43dag8262g718e7b0b8b6c;1"
data "Icon" "statIcons_RadiatingOrb"
data "Properties" "IsHidden"
data "Conditions" "Self() and not HasStatus('SIN_Candlelight_Orb') and not HasObscuredState(ObscuredState.Clear) and not HasStatus('AURA_OF_VILEOBLIVION_BUFF') and not HasStatus('SCL_MOONSHIELD') and not HasStatus('SNEAKING') and not HasStatus('SG_Invisible') and not InSurface('SurfaceDarknessCloud') and not InSurface('SurfaceFogCloud') and not InSurface('SurfaceLava') and not InSurface('SurfaceSporeBlackCloud') and not InSurface('SurfaceStinkingCloud') and not InSurface('SurfaceCloudkillCloud')"
data "StatsFunctorContext" "OnMovedDistance;OnStatusApplied;OnStatusRemoved"
data "StatsFunctors" "ApplyStatus(SELF,SIN_Candlelight_Orb,100,-1)"
data "Boosts" "UnlockSpell(SIN_Candlelight_Dismiss)"

new entry "SIN_Candlelight_Dismiss"
type "SpellData"
data "SpellType" "Shout"
using "SIN_Light_Dismiss"
data "SpellProperties" "RemoveStatus(SELF,SIN_CANDLELIGHT)"
data "Icon" "statIcons_RadiatingOrb"
data "DisplayName" "h2020b280g0721g48f6g9cb6g8dc5e012399f;1"
data "Description" "h775df818g6b72g49e9g9c3ega8e7cd73941e;1"

new entry "SIN_Candlelight_Orb"
type "StatusData"
data "StatusType" "BOOST"
data "SoundLoop" "Misc_Status_RadiantRadiatingOrb"
data "SoundStop" "Misc_Status_RadiantRadiatingOrb_Stop"
data "Boosts" "GameplayLight(3,false,0.1)"
data "IsUnique" "1"
data "StatusEffect" "c15c513d-b7df-43c9-b35d-b3e73b5c51b7"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "RemoveConditions" "IsInSunlight(context.Source) or HasStatus('AURA_OF_VILEOBLIVION_BUFF',context.Source) or HasStatus('SCL_MOONSHIELD',context.Source) or HasStatus('SNEAKING',context.Source) or HasStatus('SG_Invisible',context.Source)"
data "RemoveEvents" "OnObscurityChanged;OnStatusApplied"

//-----------------------------------
//-PRODUCE FLAME

new entry "PRODUCE_FLAME"
type "StatusData"
data "StatusType" "BOOST"
using "PRODUCE_FLAME"
data "Boosts" "UnlockSpell(Shout_ProduceFlame_Dismiss)"
data "SoundLoop" ""
data "SoundStop" ""
data "StatusGroups" "SG_RemoveOnRespec"
data "StatusEffect" ""
data "Passives" "SIN_Produce_Flame_Passive"

new entry "SIN_Produce_Flame_Passive"
type "PassiveData"
data "Properties" "IsHidden"
data "Conditions" "Self() and not HasStatus('SIN_Produce_Flame') and not HasObscuredState(ObscuredState.Clear) and not HasStatus('AURA_OF_VILEOBLIVION_BUFF') and not HasStatus('SCL_MOONSHIELD') and not HasStatus('SNEAKING') and not HasStatus('SG_Invisible') and not InSurface('SurfaceDarknessCloud') and not InSurface('SurfaceFogCloud') and not InSurface('SurfaceLava') and not InSurface('SurfaceSporeBlackCloud') and not InSurface('SurfaceStinkingCloud') and not InSurface('SurfaceCloudkillCloud')"
data "StatsFunctorContext" "OnMovedDistance;OnStatusApplied;OnStatusRemoved"
data "StatsFunctors" "ApplyStatus(SELF,SIN_Produce_Flame,100,-1)"

new entry "SIN_Produce_Flame"
type "StatusData"
data "StatusType" "BOOST"
data "SoundLoop" "Spell_Status_ProduceFlame_MO"
data "SoundStop" "Spell_Status_ProduceFlame_MO_Stop"
data "Boosts" "GameplayLight(9,false,0.1)"
data "IsUnique" "1"
data "StatusEffect" "7b9c612c-3780-45eb-a146-fc472c37c2c4"
data "StatusPropertyFlags" "DisableOverhead;DisableCombatlog;DisablePortraitIndicator"
data "RemoveConditions" "not HasStatus('PRODUCE_FLAME',context.Source) or IsInSunlight(context.Source) or HasStatus('AURA_OF_VILEOBLIVION_BUFF',context.Source) or HasStatus('SCL_MOONSHIELD',context.Source) or HasStatus('SNEAKING',context.Source) or HasStatus('SG_Invisible',context.Source)"
data "RemoveEvents" "OnObscurityChanged;OnStatusApplied;OnStatusRemoved"
data "StatusGroups" "SG_Light"